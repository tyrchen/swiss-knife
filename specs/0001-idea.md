# 视频转录和内容生成工具

## 功能描述

一个 bash 脚本，用于自动提取视频音频、转录文字并生成社交媒体内容。

## 核心功能

1. **音频提取**：使用 ffmpeg 从视频中提取音频，保存为低质量 MP3（32kbps, 16kHz, 单声道）以优化文件大小
2. **智能分块**：对于超过 1300 秒的长视频，自动分割成多个 1300 秒的音频块
3. **音频转录**：使用 OpenAI 的 `gpt-4o-transcribe` API 将音频转换为中文文字
4. **内容生成**：使用 `gpt-5-mini` API 生成：
   - 3 个备选标题（每个不超过 16 字）
   - 2 段详细描述（每段 300-500 字）
   - 3 个 Bilibili 动态更新（每个 150-250 字）

## 技术特性

- **缓存机制**：自动检测并跳过已存在的音频和转录文件，避免重复处理
- **错误处理**：完善的 HTTP 状态码检查和错误信息输出
- **文件压缩**：自动压缩超过 24MB 的音频文件以满足 API 限制
- **并行处理**：分块音频可独立处理，提高效率

## 使用方法

```bash
./scripts/convert.sh <video_file>
```

## 输出文件

所有文件保存在 `/tmp` 目录下：
- `${VIDEO_NAME}.mp3` - 提取的音频文件
- `${VIDEO_NAME}_transcript.txt` - 完整转录文本
- `${VIDEO_NAME}_content.json` - GPT 生成的完整内容
- `${VIDEO_NAME}_titles.txt` - 备选标题列表
- `${VIDEO_NAME}_descriptions.txt` - 视频描述
- `${VIDEO_NAME}_status.txt` - Bilibili 动态文案

对于长视频，还会生成：
- `${VIDEO_NAME}_chunk_${i}.mp3` - 音频分块
- `${VIDEO_NAME}_chunk_${i}_transcript.txt` - 分块转录

## API 配置

需要设置环境变量：
```bash
export OPENAI_API_KEY="your-api-key"
```

## 模型说明

- **gpt-4o-transcribe**：OpenAI 最新的音频转录模型，支持中文
- **gpt-5-mini**：OpenAI 最新的文本生成模型，专门优化了 JSON 输出格式
